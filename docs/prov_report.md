# Provenance Reports

The provenance reports generated by the registry are based around the concepts
of `activities`, `agents` and `entities`. For more information about these
concepts see the [PROV Ontology](https://www.w3.org/TR/prov-o/)

Provenance reports are only available for `DataProducts` and can be accessed via
the [RESTful API](api_guide.md) for example:

```
https://data.scrc.uk/api/prov-report/3/
```

## Query parameters
 
* format

  * **api**: a html representation of the report with media type of `text/html`
  * **json**: a json representation of the report with media type of
`application/json`
  * **json-ld**: a json-ld representation of the report with media type of
`application/ld+json`
  * **jpg**: an image representing the provenance with media type of
`image/jpeg`
  * **svg**: an interactive image representing the provenance with media type of
`image/svg+xml`
  * **xml**: an XML representation of the report with media type of `text/xml`
  * **provn**: a PROV-N representation of the report with media type of
`text/provenance-notation`

* aspect_ratio

  * **\<float>**: a float used to define the ratio for images. The default is
0.71, which is equivalent to A4 landscape.

* attributes

  * **True** (default): show the attributes associated with an object
  * **False**: hide the attributes associated with an object

* dpi

    * **\<float>**: a float used to define the dpi for images

## Prefixes

All `activities`, `agents` and `entities` have a URI. Prefixes are used to
represent the base component of these URIs. Two different prefixes are used,
`reg` and `lreg`, where `reg` is used as the prefix for the central registry and
`lreg` is used to refer to a local registry. Hence dependent on the location of
the object you may see:

```
reg:api/data_product/1
```

or

```
lreg:api/data_product/1
```

Using `provn` as an example you may see a section similar to:

```
  prefix lreg <http://192.168.20.10:8000/>
  prefix fair <https://data.scrc.uk/vocab/#>
  prefix dcat <http://www.w3.org/ns/dcat#>
  prefix dcmitype <http://purl.org/dc/dcmitype/>
  prefix dcterms <http://purl.org/dc/terms/>
  prefix foaf <http://xmlns.com/foaf/spec/#>
```


## Examples

### Basic Example

For a simple case the report will contain two entities, a `DataProduct` and
an `ExternalObject`, where the `DataProduct` is a `specializationOf` an
`ExternalObject`.

```xml
<prov:entity prov:id="lreg:api/data_product/5">
  <prov:type xsi:type="xsd:QName">dcat:Dataset</prov:type>
  <dcat:hasVersion>0.1.0</dcat:hasVersion>
  <dcterms:modified xsi:type="xsd:dateTime">2021-09-20T13:34:24.592963+00:00</dcterms:modified>
  <dcterms:title>this/is/a/sample/1</dcterms:title>
  <fair:namespace>FAIR</fair:namespace>
  <prov:atLocation>
    ftp://boydorr.gla.ac.uk/scrc/human/infection/SARS-CoV-2/scotland/cases_and_management/v0.1.0.csv
  </prov:atLocation>
</prov:entity>
<prov:entity prov:id="lreg:api/external_object/3">
  <prov:type xsi:type="xsd:QName">dcat:Dataset</prov:type>
  <dcat:hasVersion>0.1.0</dcat:hasVersion>
  <dcterms:description>
    scottish coronavirus-covid-19-management-information dataset
  </dcterms:description>
  <dcterms:issued xsi:type="xsd:dateTime">2010-07-10T18:38:00+00:00</dcterms:issued>
  <dcterms:title>
    scottish coronavirus-covid-19-management-information
  </dcterms:title>
  <fair:alternate_identifier>
    scottish coronavirus-covid-19-management-information
  </fair:alternate_identifier>
  <fair:alternate_identifier_type>Scottish Health and Social Care Open Data id</fair:alternate_identifier_type>
  <prov:atLocation>
    https://statistics.gov.scot/sparql.csv?query=PREFIX qb: <http://purl.org/linked-data/cube#>PREFIX data: <http://statistics.gov.scot/data/>PREFIX rdfs: <http://www.w3.org/2000/01/rdf-schema#>PREFIX dim: <http://purl.org/linked-data/sdmx/2009/dimension#>PREFIX sdim: <http://statistics.gov.scot/def/dimension/>PREFIX stat: <http://statistics.data.gov.uk/def/statistical-entity#>PREFIX mp: <http://statistics.gov.scot/def/measure-properties/>SELECT ?featurecode ?featurename ?areatypename ?date ?cause ?location ?gender ?age ?type ?countWHERE { ?indicator qb:dataSet data:deaths-involving-coronavirus-covid-19; mp:count ?count; qb:measureType ?measType; sdim:age ?value; sdim:causeofdeath ?causeDeath; sdim:locationofdeath ?locDeath; sdim:sex ?sex; dim:refArea ?featurecode; dim:refPeriod ?period. ?measType rdfs:label ?type. ?value rdfs:label ?age. ?causeDeath rdfs:label ?cause. ?locDeath rdfs:label ?location. ?sex rdfs:label ?gender. ?featurecode stat:code ?areatype; rdfs:label ?featurename. ?areatype rdfs:label ?areatypename. ?period rdfs:label ?date.}
  </prov:atLocation>
</prov:entity>
<prov:specializationOf>
  <prov:specificEntity prov:ref="lreg:api/external_object/3"/>
  <prov:generalEntity prov:ref="lreg:api/data_product/5"/>
</prov:specializationOf>
```

### A Data Product Generated from a Code Run

In a complete example a `DataProduct` entity would have a relationship of
`wasGeneratedBy` with a `CodeRun` activity, it would have a relationship of
`wasAttributedTo` with an `Author` agent and it would have a relationship of
`wasDerivedFrom` one or more `DataProducts` entities.

In turn the `CodeRun` would have a relationship of `wasStartedBy` with an
`Author`, it would have `used` a model_cofiguration, submission_script,
`CodeRepoRelease` and one or more `DataProducts`

### An example of a provenance diagram
![](prov_example.jpeg)